<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="https://res.cloudinary.com/djttn4xvk/image/upload/v1744016662/iv8s8dkwdzxgnubsnhla.ico">
    <title>Poxel Competitive</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #121212;
            color: #ffffff;
        }
        
        header {
            background-color: #1e1e1e;
            color: #ffffff;
            text-align: center;
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-bottom: 3px solid #FFA500;
            position: relative;
        }
        
        .header-container {
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        
        h1 {
            margin: 0;
            font-size: 2.5rem;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        
        .nav-button {
            position: absolute;
            left: 2rem;
            top: 50%;
            transform: translateY(-50%);
            background-color: #FFA500;
            color: #000000;
            font-weight: bold;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .nav-button:hover {
            background-color: #FFB833;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        .nav-button:active {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        
        section {
            margin-bottom: 3rem;
            background-color: #1e1e1e;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        h2 {
            border-bottom: 2px solid #FFA500;
            padding-bottom: 0.5rem;
            margin-top: 0;
        }
        
        .match {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin-bottom: 1rem;
            background-color: #2d2d2d;
            border-radius: 4px;
            transition: transform 0.2s;
        }
        
        .match:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }
        
        .match-teams {
            flex: 2;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .match-details {
            flex: 1;
            text-align: center;
            color: #cccccc;
        }
        
        .match-time {
            flex: 1;
            text-align: right;
        }
        
        .countdown {
            font-size: 1.1rem;
            font-weight: bold;
            color: #ffffff;
        }
        
        .live {
            color: #ffffff;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-flex;
            align-items: center;
            font-weight: bold;
        }
        
        .live-dot {
            width: 10px;
            height: 10px;
            background-color: #00ff00;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #333;
        }
        
        th {
            background-color: #FFA500;
            color: black;
        }
        
        tr:hover {
            background-color: #2d2d2d;
        }
        
        .bracket {
            display: flex;
            overflow-x: auto;
            padding: 2rem 0;
        }
        
        .bracket-round {
            display: flex;
            flex-direction: column;
            margin-right: 2rem;
            min-width: 200px;
        }
        
        .bracket-title {
            text-align: center;
            margin-bottom: 1rem;
            color: #FFA500;
            font-weight: bold;
        }
        
        .bracket-match {
            margin-bottom: 1.5rem;
            background-color: #2d2d2d;
            border-radius: 4px;
            padding: 1rem;
            position: relative;
        }
        
        .bracket-match:after {
            content: '';
            position: absolute;
            right: -2rem;
            top: 50%;
            width: 2rem;
            height: 2px;
            background-color: #FFA500;
        }
        
        .bracket-round:last-child .bracket-match:after {
            display: none;
        }
        
        .team {
            margin-bottom: 0.5rem;
        }
        
        .team-name {
            font-weight: bold;
            margin-bottom: 0.2rem;
        }
        
        .team-players {
            font-size: 0.85rem;
            color: #cccccc;
        }
        
        .buttons {
            margin-top: 1rem;
            display: flex;
            gap: 10px;
        }
        
        button {
            background-color: #FFA500;
            color: black;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background-color: #FFB833;
        }
        
        .hidden {
            display: none;
        }
        
        footer {
            text-align: center;
            padding: 2rem 0;
            margin-top: 2rem;
            background-color: #1e1e1e;
            border-top: 1px solid #333;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            font-size: 1.2rem;
            color: #FFA500;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <a href="clanwar.html" class="nav-button">Clan Wars</a>
            <h1>Poxel Competitive</h1>
        </div>
    </header>
    
    <main>
        <section id="upcoming-matches">
            <h2>Upcoming Matches</h2>
            <div id="matches-container" class="loading">Loading matches...</div>
        </section>
        
        <section id="clan-stats">
            <h2>Player Statistics</h2>
            <table id="clan-table">
                <thead>
                    <tr>
                        <th>Player Name</th>
                        <th>Wins</th>
                        <th>Losses</th>
                        <th>Win Rate</th>
                    </tr>
                </thead>
                <tbody id="clan-stats-body" class="loading">
                    <tr>
                        <td colspan="4" class="loading">Loading player stats...</td>
                    </tr>
                </tbody>
            </table>
        </section>
        
        <section id="tournament">
            <h2>Tournament Bracket</h2>
            <div class="bracket" id="bracket-container">
                <div class="loading">Loading tournament bracket...</div>
            </div>
        </section>
    </main>
    
    <footer>
        <p>Â© 2025 Poxel Competitive</p>
    </footer>
    
    <script>
        // API URL - change this to your deployed server URL
        const API_URL = 'http://localhost:3000/api';
        
        // Data structures for matches, clans, and tournament
        let matches = [];
        let clans = [];
        let tournament = { rounds: [] };
        
        // Function to fetch data from API
        async function fetchData() {
            try {
                // Fetch matches
                const matchesResponse = await fetch(`${API_URL}/matches`);
                matches = await matchesResponse.json();
                
                // Fetch clans/players
                const clansResponse = await fetch(`${API_URL}/clans`);
                clans = await clansResponse.json();
                
                // Fetch tournament
                const tournamentResponse = await fetch(`${API_URL}/tournament`);
                tournament = await tournamentResponse.json();
                
                // Render the data
                renderMatches();
                renderClanStats();
                renderTournament();
            } catch (error) {
                console.error('Error fetching data:', error);
                
                // Show error message in each section
                document.getElementById('matches-container').innerHTML = 
                    '<div class="error">Failed to load matches. Please try again later.</div>';
                
                document.getElementById('clan-stats-body').innerHTML = 
                    '<tr><td colspan="4" class="error">Failed to load player stats. Please try again later.</td></tr>';
                
                document.getElementById('bracket-container').innerHTML = 
                    '<div class="error">Failed to load tournament bracket. Please try again later.</div>';
            }
        }
        
        // Function to render matches
        function renderMatches() {
            const matchesContainer = document.getElementById('matches-container');
            matchesContainer.innerHTML = '';
            
            if (matches.length === 0) {
                matchesContainer.innerHTML = '<div>No upcoming matches scheduled.</div>';
                return;
            }
            
            matches.forEach(match => {
                const matchElement = document.createElement('div');
                matchElement.className = 'match';
                
                const now = Date.now();
                const isLive = now >= match.timestamp && now < (match.timestamp + 3600000); // Consider a match live for 1 hour
                match.live = isLive;
                
                let timeDisplay;
                if (isLive) {
                    timeDisplay = `<div class="live"><span class="live-dot"></span> LIVE MATCH</div>`;
                } else if (now < match.timestamp) {
                    timeDisplay = `<div class="countdown" data-time="${match.timestamp}">Loading...</div>`;
                } else {
                    timeDisplay = `<div>Completed</div>`;
                }
                
                matchElement.innerHTML = `
                    <div class="match-teams">${match.team1} vs ${match.team2}</div>
                    <div class="match-details">${match.details}</div>
                    <div class="match-time">${timeDisplay}</div>
                `;
                
                matchesContainer.appendChild(matchElement);
            });
            
            // Start the countdown timers
            updateCountdowns();
        }
        
        // Function to update countdown timers
        function updateCountdowns() {
            const countdowns = document.querySelectorAll('.countdown');
            
            countdowns.forEach(countdown => {
                const targetTime = parseInt(countdown.getAttribute('data-time'));
                const now = Date.now();
                const diff = targetTime - now;
                
                if (diff <= 0) {
                    // Reload to show "LIVE" instead of countdown
                    renderMatches();
                    return;
                }
                
                // Calculate days, hours, minutes, seconds
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                let timeString = '';
                if (days > 0) timeString += `${days}d `;
                timeString += `${hours.toString().padStart(2, '0')}:`;
                timeString += `${minutes.toString().padStart(2, '0')}:`;
                timeString += `${seconds.toString().padStart(2, '0')}`;
                
                countdown.textContent = timeString;
            });
        }
        
        // Function to render clan stats
        function renderClanStats() {
            const clanStatsBody = document.getElementById('clan-stats-body');
            clanStatsBody.innerHTML = '';
            
            if (clans.length === 0) {
                clanStatsBody.innerHTML = '<tr><td colspan="4">No players registered.</td></tr>';
                return;
            }
            
            clans.sort((a, b) => b.wins - a.wins);
            
            clans.forEach(clan => {
                const totalGames = clan.wins + clan.losses;
                const winRate = totalGames > 0 ? (clan.wins / totalGames * 100).toFixed(1) : '0.0';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${clan.name}</td>
                    <td>${clan.wins}</td>
                    <td>${clan.losses}</td>
                    <td>${winRate}%</td>
                `;
                
                clanStatsBody.appendChild(row);
            });
        }
        
        // Function to render tournament bracket
        function renderTournament() {
            const bracketContainer = document.getElementById('bracket-container');
            bracketContainer.innerHTML = '';
            
            if (!tournament || !tournament.rounds || tournament.rounds.length === 0) {
                bracketContainer.innerHTML = '<div>No tournament bracket available.</div>';
                return;
            }
            
            tournament.rounds.forEach(round => {
                const roundElement = document.createElement('div');
                roundElement.className = 'bracket-round';
                
                const roundTitle = document.createElement('div');
                roundTitle.className = 'bracket-title';
                roundTitle.textContent = round.name;
                roundElement.appendChild(roundTitle);
                
                round.matches.forEach(match => {
                    const matchElement = document.createElement('div');
                    matchElement.className = 'bracket-match';
                    
                    // Team 1
                    const team1Element = document.createElement('div');
                    team1Element.className = 'team';
                    team1Element.innerHTML = `
                        <div class="team-name">${match.team1.name}</div>
                        <div class="team-players">${match.team1.players.join(', ')}</div>
                    `;
                    matchElement.appendChild(team1Element);
                    
                    // Team 2
                    const team2Element = document.createElement('div');
                    team2Element.className = 'team';
                    team2Element.innerHTML = `
                        <div class="team-name">${match.team2.name}</div>
                        <div class="team-players">${match.team2.players.join(', ')}</div>
                    `;
                    matchElement.appendChild(team2Element);
                    
                    roundElement.appendChild(matchElement);
                });
                
                bracketContainer.appendChild(roundElement);
            });
        }
        
        // Initialize the website
        function initializeWebsite() {
            // Fetch initial data
            fetchData();
            
            // Update countdowns every second
            setInterval(updateCountdowns, 1000);
            
            // Check for live matches every minute
            setInterval(renderMatches, 60000);
            
            // Refresh data from API every 5 minutes
            setInterval(fetchData, 300000);
        }
        
        // Start the website when the DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeWebsite);
    </script>
</body>
</html>

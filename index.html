<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="https://res.cloudinary.com/djttn4xvk/image/upload/v1744016662/iv8s8dkwdzxgnubsnhla.ico">
    <title>Poxel Competitive</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #121212;
            color: #ffffff;
        }
        
        header {
            background-color: #1e1e1e;
            color: #ffffff;
            text-align: center;
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-bottom: 3px solid #FFA500;
            position: relative;
        }
        
        .header-container {
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        
        h1 {
            margin: 0;
            font-size: 2.5rem;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        
        .nav-button {
            position: absolute;
            left: 2rem;
            top: 50%;
            transform: translateY(-50%);
            background-color: #FFA500;
            color: #000000;
            font-weight: bold;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .nav-button:hover {
            background-color: #FFB833;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        .nav-button:active {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        
        section {
            margin-bottom: 3rem;
            background-color: #1e1e1e;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        h2 {
            border-bottom: 2px solid #FFA500;
            padding-bottom: 0.5rem;
            margin-top: 0;
        }
        
        .match {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin-bottom: 1rem;
            background-color: #2d2d2d;
            border-radius: 4px;
            transition: transform 0.2s;
        }
        
        .match:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }
        
        .match-teams {
            flex: 2;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .match-details {
            flex: 1;
            text-align: center;
            color: #cccccc;
        }
        
        .match-time {
            flex: 1;
            text-align: right;
        }
        
        .countdown {
            font-size: 1.1rem;
            font-weight: bold;
            color: #ffffff;
        }
        
        .live {
            color: #ffffff;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-flex;
            align-items: center;
            font-weight: bold;
        }
        
        .live-dot {
            width: 10px;
            height: 10px;
            background-color: #00ff00;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #333;
        }
        
        th {
            background-color: #FFA500;
            color: black;
        }
        
        tr:hover {
            background-color: #2d2d2d;
        }
        
        .bracket {
            display: flex;
            overflow-x: auto;
            padding: 2rem 0;
        }
        
        .bracket-round {
            display: flex;
            flex-direction: column;
            margin-right: 2rem;
            min-width: 200px;
        }
        
        .bracket-title {
            text-align: center;
            margin-bottom: 1rem;
            color: #FFA500;
            font-weight: bold;
        }
        
        .bracket-match {
            margin-bottom: 1.5rem;
            background-color: #2d2d2d;
            border-radius: 4px;
            padding: 1rem;
            position: relative;
        }
        
        .bracket-match:after {
            content: '';
            position: absolute;
            right: -2rem;
            top: 50%;
            width: 2rem;
            height: 2px;
            background-color: #FFA500;
        }
        
        .bracket-round:last-child .bracket-match:after {
            display: none;
        }
        
        .team {
            margin-bottom: 0.5rem;
        }
        
        .team-name {
            font-weight: bold;
            margin-bottom: 0.2rem;
        }
        
        .team-players {
            font-size: 0.85rem;
            color: #cccccc;
        }
        
        .update-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #FFA500;
            color: black;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .update-notification.show {
            opacity: 1;
        }
        
        footer {
            text-align: center;
            padding: 2rem 0;
            margin-top: 2rem;
            background-color: #1e1e1e;
            border-top: 1px solid #333;
        }
        
        .last-updated {
            font-size: 0.8rem;
            color: #999;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <a href="clanwar.html" class="nav-button">Clan Wars</a>
            <h1>Poxel Competitive</h1>
        </div>
    </header>
    
    <main>
        <section id="upcoming-matches">
            <h2>Upcoming Matches</h2>
            <div id="matches-container">
                <!-- Matches will be inserted here by JavaScript -->
            </div>
        </section>
        
        <section id="clan-stats">
            <h2>Player Statistics</h2>
            <table id="clan-table">
                <thead>
                    <tr>
                        <th>Player Name</th>
                        <th>Wins</th>
                        <th>Losses</th>
                        <th>Win Rate</th>
                    </tr>
                </thead>
                <tbody id="clan-stats-body">
                    <!-- Clan stats will be inserted here by JavaScript -->
                </tbody>
            </table>
        </section>
        
        <section id="tournament">
            <h2>Tournament Bracket</h2>
            <div class="bracket" id="bracket-container">
                <!-- Tournament bracket will be inserted here by JavaScript -->
            </div>
        </section>
    </main>
    
    <div id="update-notification" class="update-notification">Data updated!</div>
    
    <footer>
        <p>Â© 2025 Poxel Competitive</p>
        <p class="last-updated">Last updated: <span id="last-updated-time">Loading...</span></p>
    </footer>
    
    <script>
        // Data structures for matches, clans, and tournament
        let matches = [];
        let clans = [];
        let tournament = { rounds: [] };
        let lastFetchTime = 0;
        
        // Function to render matches
        function renderMatches() {
            const matchesContainer = document.getElementById('matches-container');
            matchesContainer.innerHTML = '';
            
            if (matches.length === 0) {
                matchesContainer.innerHTML = '<p>No upcoming matches</p>';
                return;
            }
            
            matches.forEach(match => {
                const matchElement = document.createElement('div');
                matchElement.className = 'match';
                
                const now = Date.now();
                const isLive = now >= match.timestamp && now < (match.timestamp + 3600000); // Consider a match live for 1 hour
                
                let timeDisplay;
                if (isLive) {
                    timeDisplay = `<div class="live"><span class="live-dot"></span> LIVE MATCH</div>`;
                } else if (now < match.timestamp) {
                    timeDisplay = `<div class="countdown" data-time="${match.timestamp}">Loading...</div>`;
                } else {
                    timeDisplay = `<div>Completed</div>`;
                }
                
                matchElement.innerHTML = `
                    <div class="match-teams">${match.team1} vs ${match.team2}</div>
                    <div class="match-details">${match.details}</div>
                    <div class="match-time">${timeDisplay}</div>
                `;
                
                matchesContainer.appendChild(matchElement);
            });
            
            // Start the countdown timers
            updateCountdowns();
        }
        
        // Function to update countdown timers
        function updateCountdowns() {
            const countdowns = document.querySelectorAll('.countdown');
            
            countdowns.forEach(countdown => {
                const targetTime = parseInt(countdown.getAttribute('data-time'));
                const now = Date.now();
                const diff = targetTime - now;
                
                if (diff <= 0) {
                    // Reload to show "LIVE" instead of countdown
                    renderMatches();
                    return;
                }
                
                // Calculate days, hours, minutes, seconds
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                let timeString = '';
                if (days > 0) timeString += `${days}d `;
                timeString += `${hours.toString().padStart(2, '0')}:`;
                timeString += `${minutes.toString().padStart(2, '0')}:`;
                timeString += `${seconds.toString().padStart(2, '0')}`;
                
                countdown.textContent = timeString;
            });
        }
        
        // Function to render clan stats
        function renderClanStats() {
            const clanStatsBody = document.getElementById('clan-stats-body');
            clanStatsBody.innerHTML = '';
            
            if (clans.length === 0) {
                clanStatsBody.innerHTML = '<tr><td colspan="4">No player statistics available</td></tr>';
                return;
            }
            
            // Sort by wins
            const sortedClans = [...clans].sort((a, b) => b.wins - a.wins);
            
            sortedClans.forEach(clan => {
                const totalGames = clan.wins + clan.losses;
                const winRate = totalGames > 0 ? (clan.wins / totalGames * 100).toFixed(1) : '0.0';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${clan.name}</td>
                    <td>${clan.wins}</td>
                    <td>${clan.losses}</td>
                    <td>${winRate}%</td>
                `;
                
                clanStatsBody.appendChild(row);
            });
        }
        
        // Function to render tournament bracket
        function renderTournament() {
            const bracketContainer = document.getElementById('bracket-container');
            bracketContainer.innerHTML = '';
            
            if (!tournament.rounds || tournament.rounds.length === 0) {
                bracketContainer.innerHTML = '<p>No tournament data available</p>';
                return;
            }
            
            tournament.rounds.forEach(round => {
                const roundElement = document.createElement('div');
                roundElement.className = 'bracket-round';
                
                const roundTitle = document.createElement('div');
                roundTitle.className = 'bracket-title';
                roundTitle.textContent = round.name;
                roundElement.appendChild(roundTitle);
                
                if (!round.matches || round.matches.length === 0) {
                    const emptyMessage = document.createElement('div');
                    emptyMessage.className = 'bracket-match';
                    emptyMessage.textContent = 'No matches yet';
                    roundElement.appendChild(emptyMessage);
                } else {
                    round.matches.forEach(match => {
                        const matchElement = document.createElement('div');
                        matchElement.className = 'bracket-match';
                        
                        // Team 1
                        const team1Element = document.createElement('div');
                        team1Element.className = 'team';
                        team1Element.innerHTML = `
                            <div class="team-name">${match.team1.name}</div>
                            <div class="team-players">${Array.isArray(match.team1.players) ? match.team1.players.join(', ') : match.team1.players}</div>
                        `;
                        matchElement.appendChild(team1Element);
                        
                        // Team 2
                        const team2Element = document.createElement('div');
                        team2Element.className = 'team';
                        team2Element.innerHTML = `
                            <div class="team-name">${match.team2.name}</div>
                            <div class="team-players">${Array.isArray(match.team2.players) ? match.team2.players.join(', ') : match.team2.players}</div>
                        `;
                        matchElement.appendChild(team2Element);
                        
                        roundElement.appendChild(matchElement);
                    });
                }
                
                bracketContainer.appendChild(roundElement);
            });
        }
        
        // Function to fetch data from server
        async function fetchData() {
            try {
                const response = await fetch('/data.json');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const data = await response.json();
                
                // Check if data has changed
                const dataChanged = JSON.stringify(data) !== JSON.stringify({matches, clans, tournament});
                
                // Update local data
                matches = data.matches || [];
                clans = data.clans || [];
                tournament = data.tournament || { rounds: [] };
                
                // Sort matches by timestamp
                matches.sort((a, b) => a.timestamp - b.timestamp);
                
                // Render everything
                renderMatches();
                renderClanStats();
                renderTournament();
                
                // Update last fetch time
                lastFetchTime = Date.now();
                document.getElementById('last-updated-time').textContent = new Date(lastFetchTime).toLocaleString();
                
                // Show notification if data changed (except on first load)
                if (dataChanged && lastFetchTime > 0) {
                    showUpdateNotification();
                }
                
                return true;
            } catch (error) {
                console.error('Error fetching data:', error);
                return false;
            }
        }
        
        // Function to show update notification
        function showUpdateNotification() {
            const notification = document.getElementById('update-notification');
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Initialize the website
        async function initializeWebsite() {
            // Initial data fetch
            await fetchData();
            
            // Update countdowns every second
            setInterval(updateCountdowns, 1000);
            
            // Fetch new data every 30 seconds
            setInterval(fetchData, 30000);
        }
        
        // Start the website when the DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeWebsite);
    </script>
</body>
</html>
